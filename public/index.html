<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모래성 게임</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { text-align: center; font-family: sans-serif; background: #fdf5e6; }
        #sand { width: 200px; background: #edc9af; margin: 20px auto; transition: 0.5s; border-radius: 100px 100px 0 0; position: relative; }
        #stick { width: 10px; height: 150px; background: #8b4513; position: absolute; bottom: 80%; left: 95px; transition: 0.5s; transform-origin: bottom; }
        .controls { display: none; margin-top: 20px; }
        button { padding: 10px 20px; font-size: 16px; background: #d2691e; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>
    <h2 id="msg">플레이어를 기다리는 중...</h2>
    <button id="start-btn" style="display:none;" onclick="socket.emit('startGame')">게임 시작!</button>
    <div id="sand"><div id="stick"></div></div>
    <div class="controls" id="ui">
        <input type="range" min="1" max="10" value="5" id="range" oninput="document.getElementById('v').innerText=this.value">
        <p>가져갈 양: <span id="v">5</span></p>
        <button onclick="socket.emit('takeSand', parseInt(document.getElementById('range').value))">가져오기</button>
    </div>
    <script>
        const socket = io();
        socket.on('playerUpdate', (p) => { if(p[0].id === socket.id) document.getElementById('start-btn').style.display = 'inline-block'; });
        socket.on('gameBegin', (d) => update(d.sand, d.turn));
        socket.on('updateState', (d) => update(d.sand, d.nextTurn));
        function update(s, t) {
            document.getElementById('sand').style.height = s + 'px';
            document.getElementById('stick').style.transform = `rotate(${(100-s)/4}deg)`;
            const myTurn = t === socket.id;
            document.getElementById('msg').innerText = myTurn ? "내 차례!" : "상대 차례...";
            document.getElementById('ui').style.display = myTurn ? 'block' : 'none';
            document.getElementById('start-btn').style.display = 'none';
        }
        socket.on('gameOver', (d) => {
            document.getElementById('msg').innerText = d.loser === socket.id ? "당신이 쓰러뜨렸습니다! (패배)" : "상대방이 쓰러뜨렸습니다! (승리)";
            document.getElementById('stick').style.transform = "rotate(90deg)";
            document.getElementById('ui').style.display = 'none';
        });
    </script>
</body>
</html>
